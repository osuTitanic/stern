[uwsgi]
module = app:flask
master = true
lazy-apps = true
need-app = true

# Concurrency
processes = $(FRONTEND_WORKERS)
threads = $(FRONTEND_THREADS)
enable-threads = true
single-interpreter = true
thunder-lock = true

# Process scaling
cheaper = $(UWSGI_CHEAPER_MIN)
cheaper-initial = $(UWSGI_CHEAPER_INITIAL)
cheaper-overload = $(UWSGI_CHEAPER_OVERLOAD)
cheaper-step = $(UWSGI_CHEAPER_STEP)

# Memory & lifecycle controls
reload-on-rss = 312
max-requests = 150000
max-requests-delta = 1000
harakiri = 45
worker-reload-mercy = 60
vacuum = true
die-on-term = true

# Networking
http = 0.0.0.0:80
listen = 256
so-keepalive = true
http-keepalive = 1
http-keepalive-requests = 1000
http-auto-chunked = 1
buffer-size = 65535
post-buffering = 8192
offload-threads = $(UWSGI_OFFLOAD_THREADS)

# Observability
stats = $(UWSGI_STATS)
log-date = true
log-reopen = true

# Application directory
chdir = /stern
