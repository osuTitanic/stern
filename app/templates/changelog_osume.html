{# templates/changelog_osume.html #}

{# Recreation of: #}
{# osu.ppy.sh/p/changelog?updater=1 #}

{# Sort entries by date #}
{% set sorted_entries = {} %}
{% for entry in entries %}
    {% set date_key = entry.created_at.strftime("%b %-d, %Y") %}
    {% if date_key not in sorted_entries %}
        {% set _ = sorted_entries.update({date_key: []}) %}
    {% endif %}
    {% set _ = sorted_entries[date_key].append(entry) %}
{% endfor %}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <title>osu! changelog</title>
    </head>
    <body style="width: 100%; background: #fff;">
        <script>
            function loadChangelog(last, me) {
                //$(me).html("Loading...");
                $("#more").load("/p/changelog?updater=1&from=" + last);
            }
        </script>
        <style>
            body {
                font-family: "Arial Grande",Tahoma,Helvetica,Arial,sans-serif;
                font-size: 8pt;
                margin: 0;
                padding: 0;
            }

            a {
                color: #3843a6;
                text-decoration: none;
                cursor: pointer;
            }

            a:hover {
                color: #3843a6;
                text-decoration: underline;
            }

            .paddingboth {
                padding-left: 7px;
                padding-right: 8px;
            }

            .changelog-text {
                padding: 2px 5px 2px 10px;
                text-align: left;
                background: #fff;
            }

            .row1p {
                background: #fff7f8;
            }

            .row2p {
                background: #fff1f3;
            }

            .tablebg {
                width: 100%;
                margin-top: 10px;
            }
        </style>
        <div style="width: 100%; height: 100px; background: url('/images/changelog/header.jpg')">
            <div style="position: absolute; top: 75px; right: 90px;">
                <a href="{{ config.OSU_BASEURL }}/">Web</a> |
                <a href="{{ config.OSU_BASEURL }}/wiki/">FAQ</a> |
                <a href="{{ config.OSU_BASEURL }}/forum/">Forums</a>
            </div>
        </div>
        <div class="paddingboth">
            <div>
                Welcome to the osu! updater. Below is a list of recent changes for your selected stream.
            </div>
            {% for (date, entries) in sorted_entries.items() %}
            <table border="0" cellspacing="1" cellpadding="1" class="tablebg">
                <tbody>
                    <tr>
                        <td style="font-size: 140%;">{{ date }}</td>
                    </tr>
                    {% for entry in entries %}
                    <tr>
                        <td style="background: #ff90a2;">
                            {% set type = entry.type %}
                            {% if type not in ("fix", "add", "misc") %}
                                {% set type = "misc" %}
                            {% endif %}
                            <div class="changelog-text {{ loop.cycle('row1p', 'row2p') }}">
                                <img src="/images/changelog/{{ type }}.png">&nbsp;[<a href="http://osu.ppy.sh/u/{{ entry.author }}">{{ entry.author }}</a>]
                                {{ entry.text }}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endfor %}
            <div style="margin-top: 20px; padding: 2px 0px 2px 0px; width:100%; background: #4393e4; text-align: center; color: #fff">
                <strong>
                    More change history is available
                    <a href="/p/changelog/" style="text-decoration: underline; color: #fff">here</a>!
                </strong>
            </div>
        </div>
    </body>
</html>